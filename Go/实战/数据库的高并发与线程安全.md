# 数据库的高并发与线程安全

在由go开发接口过程中，发现**在高并发下出现数据错乱**--用A商品的ID查到B商品的详情，即线程安全问题，这主要是由数据查询构造器引起的。在低并发测环境并不会复现线程安全引起的数据错乱

一开始，**[数据库](https://cloud.tencent.com/solution/database?from=10680)操作对像包括了连接器和查询器**，**只要实例化一个服务即实例化一个数据库操作对像提供数据库操作服务**。

这样设计，好处是共享链接，减少打开连接句柄的开销，提升数据库操作的并发能力和服务器的连接开销。但缺点是共享的链接是在同一个数据库操作对像中，在构造查询器中涉及查询语句的构建，这样，就会在多个商品高并发查询时，引起查询语句在多线程下获得本不是所属商品的查询语句。

改良的办法就是**将数据库查询构造器从数据库操作对像中分离出来，并引用同一个连接器对像**，这里一定要使用指针，不然就会发起多个数据库连接。